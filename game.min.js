// Cycle || CC BY-NC 2.0 FR Rémi Perrot 2014
// https://creativecommons.org/licenses/by-nc/2.0/fr/
var levels=[{plateformes:[[46.45161290322581,0],[81.29032258064515,0],[116.1290322580645,0],[150.96774193548387,0],[185.80645161290326,0],[220.64516129032265,0],[255.48387096774204,0],[290.3225806451614,0],[325.1612903225808,0]],pieges:[],etoiles:[[292,2],[220,2],[151,2],[83,2]]},{plateformes:[],pieges:[[92.9032258064516,0],[104.51612903225805,0],[116.1290322580645,0]],etoiles:[[50,1],[69,2],[86,3],[103,4],[118,3],[137,2],[158,1],[190,0]]},{plateformes:[[267.09677419354847,0],[278.70967741935493,0],[290.3225806451614,0],[301.93548387096786,0],[37.89473684210526,1],[47.368421052631575,1],[56.84210526315789,1],[198.94736842105254,1],[208.42105263157885,1],[217.89473684210515,1],[90.00000000000001,2],[98.1818181818182,2],[106.36363636363639,2],[114.54545454545458,2],[122.72727272727276,2],[130.90909090909093,2],[139.09090909090912,2],[147.2727272727273,2],[220.909090909091,2]],pieges:[],etoiles:[[102,4],[126,4],[224,4]]},{plateformes:[[23.225806451612904,0],[34.83870967741936,0],[46.45161290322581,0],[69.6774193548387,0],[92.9032258064516,0],[104.51612903225805,0],[116.1290322580645,0],[197.41935483870972,0],[232.2580645161291,0],[290.3225806451614,0],[301.93548387096786,0],[313.5483870967743,0]],pieges:[[139.3548387096774,0],[150.96774193548387,0],[162.58064516129033,0],[209.03225806451618,0],[220.64516129032265,0],[267.09677419354847,0],[66.3157894736842,1],[75.78947368421052,1]],etoiles:[[36,1],[73,4],[107,1],[192,1],[239,1],[301,2]]},{plateformes:[[46.45161290322581,0],[58.064516129032256,0],[69.6774193548387,0],[92.9032258064516,0],[116.1290322580645,0],[127.74193548387095,0],[150.96774193548387,0],[185.80645161290326,0],[209.03225806451618,0],[255.48387096774204,0],[313.5483870967743,0],[85.26315789473684,1],[94.73684210526315,1],[104.21052631578947,1],[123.1578947368421,1],[151.57894736842104,1],[179.99999999999994,1],[189.47368421052624,1],[208.42105263157885,1],[255.78947368421035,1],[312.63157894736815,1],[114.54545454545458,2],[122.72727272727276,2],[130.90909090909093,2],[147.2727272727273,2],[155.4545454545455,2],[180.00000000000006,2],[188.18181818181824,2],[204.54545454545462,2],[212.7272727272728,2],[253.63636363636374,2],[310.90909090909105,2],[144,3],[151.2,3],[158.39999999999998,3],[179.99999999999994,3],[187.19999999999993,3],[201.5999999999999,3],[208.7999999999999,3],[215.9999999999999,3],[251.99999999999983,3],[259.1999999999998,3],[309.59999999999974,3],[170.5263157894737,4],[176.84210526315792,4],[183.15789473684214,4],[189.47368421052636,4],[195.78947368421058,4],[202.1052631578948,4],[208.42105263157902,4],[214.73684210526324,4],[221.05263157894746,4],[227.36842105263167,4],[252.63157894736855,4],[258.9473684210528,4],[309.4736842105265,4],[245.7142857142858,5],[251.42857142857153,5],[257.1428571428572,5],[262.85714285714295,5],[308.5714285714287,5],[281.7391304347823,6],[286.9565217391301,6],[292.1739130434779,6],[297.3913043478257,6],[302.60869565217354,6],[307.82608695652135,6],[313.04347826086916,6],[318.260869565217,6],[323.4782608695648,6],[328.6956521739126,6],[333.9130434782604,6]],pieges:[],etoiles:[[25,1],[67,2],[102,3],[131,4],[160,5],[197,6],[219,6],[248,7],[262,7],[297,8],[321,8],[351,8],[318,8]]},{plateformes:[[46.45161290322581,0],[127.74193548387095,0],[139.3548387096774,0],[232.2580645161291,0],[56.84210526315789,1],[132.6315789473684,1],[217.89473684210515,1],[227.36842105263145,1],[236.84210526315775,1],[246.31578947368405,1],[65.45454545454545,2],[130.90909090909093,2],[72.00000000000001,3],[129.60000000000002,3],[295.19999999999976,3],[302.39999999999975,3],[309.59999999999974,3],[316.7999999999997,3],[82.10526315789474,4],[170.5263157894737,4],[176.84210526315792,4],[183.15789473684214,4],[189.47368421052636,4],[91.4285714285714,5],[99.13043478260872,6],[105.59999999999997,7],[110.39999999999996,7],[115.19999999999996,7],[119.99999999999996,7],[139.2,7],[144,7],[148.8,7],[153.60000000000002,7]],pieges:[],etoiles:[[81,0],[95,1],[111,0],[56,4],[80,6],[112,8],[131,5],[147,8],[179,5],[171,1],[196,1],[231,2],[304,0],[307,4]]},{plateformes:[[0,0],[11.612903225806452,0],[23.225806451612904,0],[34.83870967741936,0],[325.1612903225808,0],[336.77419354838725,0],[348.3870967741937,0],[81.81818181818183,2],[90.00000000000001,2],[98.1818181818182,2],[180.00000000000006,2],[223.19999999999987,3],[230.39999999999986,3],[237.59999999999985,3],[273.5999999999998,3],[280.7999999999998,3],[126.31578947368418,4],[132.63157894736838,4],[138.9473684210526,4],[214.73684210526324,4],[221.05263157894746,4],[240.0000000000001,4],[246.31578947368433,4],[252.63157894736855,4],[297.3913043478257,6],[302.60869565217354,6],[321.6000000000004,7],[326.40000000000043,7]],pieges:[[46.45161290322581,0],[58.064516129032256,0],[69.6774193548387,0],[81.29032258064515,0],[92.9032258064516,0],[104.51612903225805,0],[116.1290322580645,0],[127.74193548387095,0],[139.3548387096774,0],[150.96774193548387,0],[162.58064516129033,0],[174.1935483870968,0],[185.80645161290326,0],[197.41935483870972,0],[209.03225806451618,0],[220.64516129032265,0],[232.2580645161291,0],[243.87096774193557,0],[255.48387096774204,0],[267.09677419354847,0],[278.70967741935493,0],[290.3225806451614,0],[301.93548387096786,0],[313.5483870967743,0]],etoiles:[[353,7],[88,3],[131,5],[165,5],[180,5],[196,5],[231,4],[246,5],[217,5],[278,4],[293,8],[319,8]]}];var fr={Tester:"Tester",Presentation:"Bonjour les copains\nDéplacez vous avec les flèches du clavier.\nUtilisez espace pour sauter.\n\nFuyez la nuit!\n\nAppuyez sur espace commencer",Retour:"Revenir",Editeur:"Créez votre propre niveau",Jeu:"Jouez au jeu",Ou:"Ou ...",Menu:"Menu",Victoire:"VICTOIRE!",HowToBack:"(Revenez sur ce menu avec Échap)"};var en={Tester:"Try",Presentation:"Hello guys\nMove yourself with the arrow keys.\nUse space to jump.\n\nDon't get hit by the night!\n\nPush space to start",Retour:"Back",Editeur:"Make your own level",Jeu:"Play the game",Ou:"Or ...",Menu:"Menu",Victoire:"VICTORY!",HowToBack:"(Come back to this menu with Escape)"};
GameState={};var c=600;var sound=true;var dead=0;var bleu="040c4b";var jaune=0Xfbf3b4;var lang={};GameState.Boot=function(game){};GameState.Boot.prototype={preload: function(){this.game.stage.setBackgroundColor(jaune);this.game.load.image('load_plein','Ressources/LoaderPlein.png');this.game.load.image('load_vide','Ressources/LoaderVide.png');},create: function(){this.game.state.start('Load');}};GameState.Load=function(game){};GameState.Load.prototype={preload: function(){preloading2=game.add.sprite(0,0,'load_plein');preloading1=game.add.sprite(0,0,'load_vide');this.game.load.setPreloadSprite(preloading1);this.game.load.image('dude','Ressources/Dude.png');this.game.load.image('predic','Ressources/Predicteur.png');this.game.load.image('nuit','Ressources/Nuit.png');this.game.load.image('planete','Ressources/Terre.svg');this.game.load.image('plt','Ressources/TheOne.png');this.game.load.image('et','Ressources/Etoile.png');this.game.load.image('pie','Ressources/Piege.png');this.game.load.image('lang','Ressources/Lang.png');this.game.load.image('cache','Ressources/Cache.png');this.game.load.image('fs','Ressources/Follow_Souris.png');this.game.load.image('debug_point','Ressources/Point.png');},create: function(){this.game.state.start('Langue');}};GameState.Langue=function(game){};GameState.Langue.prototype={create: function(){this.game.add.sprite(0,0,'lang');this.cache=this.game.add.sprite(0,0,'cache');this.cache.blendMode=PIXI.blendModes.DIFFERENCE;},update: function(){var x_pointer=this.game.input.x;var y_pointer=this.game.input.y;if(x_pointer<=c/2)this.cache.x=0;else this.cache.x=c/2;if(this.game.input.mousePointer.isDown){if(x_pointer<=c/2)lang=fr;else lang=en;this.game.state.start('Menu');}}};
GameState.Explain=function(game){};GameState.Explain.prototype={create: function(){this.space_key=this.game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);this.esc_key=this.game.input.keyboard.addKey(Phaser.Keyboard.ESC);var label=game.add.text(c/2,c/2,lang.Presentation,{font: '25px Arial',fill: '#'+bleu,align: 'center'});label.anchor.setTo(0.5,0.5);label.alpha=0;this.game.add.tween(label)/*.delay(500)*/.to({alpha: 1},500).start();},update: function(){if(this.esc_key.isDown)this.game.state.start('Menu');if(this.space_key.isDown)this.game.state.start('Play');},};GameState.Menu=function(game){};GameState.Menu.prototype={create: function(){var play=game.add.text(c/2,c/4,lang.Jeu,{font: '50px Arial',fill: '#'+bleu,align: 'center'});play.anchor.setTo(0.5,0.5);play.alpha=0;var or=game.add.text(c/2,c/1.7,lang.Ou,{font: '23px Arial',fill: '#'+bleu,align: 'center'});or.anchor.setTo(0.5,0.5);or.alpha=0;var editor=game.add.text(c/2,c/1.5,lang.Editeur,{font: '30px Arial',fill: '#'+bleu,align: 'center'});editor.anchor.setTo(0.5,0.5);editor.alpha=0;var come_back=game.add.text(c/2,c-plataille,lang.HowToBack,{font: '18px Arial',fill: '#'+bleu,align: 'center'});come_back.anchor.setTo(0.5,1);come_back.alpha=0;this.game.add.tween(play)/*.delay(500)*/.to({alpha: 1},500).start();this.game.add.tween(or).delay(300).to({alpha: 1},500).start();this.game.add.tween(editor).delay(700).to({alpha: 1},500).start();this.game.add.tween(come_back).delay(1500).to({alpha: 1},500).start();play.inputEnabled=true;play.input.useHandCursor=true;play.events.onInputDown.add(this.play,this);editor.inputEnabled=true;editor.input.useHandCursor=true;editor.events.onInputDown.add(this.editor,this);},play: function(){this.game.state.start('Explain');},editor: function(){this.game.state.start('Edit');},update: function(){},};
var hauteur=10;var alph=0.5;var inac=0.05;var type="plat";var invert_redim=1;var pi180=Math.PI/180;var pi180_invers=1/pi180;var edited_lvl={};GameState.Edit=function(game){};GameState.Edit.prototype={create: function(){this.esc_key=this.game.input.keyboard.addKey(Phaser.Keyboard.ESC);this.general=this.game.add.group();this.general.x=c/2;this.general.y=c/2;this.dude=this.general.create(0,-c/3,'dude');this.dude.anchor.set(0.5);this.dude.alpha=0.3;this.plnte=this.general.create(0,0,'planete');this.plnte.anchor.set(0.5);var maxPlat=((hauteur*plataille+c/6)+plataille+this.dude.height)*2;if(maxPlat>c)this.redimensionne(c/maxPlat);this.plateformes=this.game.add.group(this.general);this.pieges=this.game.add.group(this.general);this.etoiles=this.game.add.group(this.general);this.etoile_pos=this.general.create(0,0,"et");this.etoile_pos.alpha=0;this.etoile_pos.anchor.set(0.6);this.etoile_pos.calculDeg=0;this.etoile_pos.calculLvl=0;this.makeSprite();this.menu=this.game.add.group(this.general);this.menu.x=maxPlat/2;this.menu.y=-maxPlat/2;this.plateforme=this.menu.create(-plataille*1.5,plataille*.5,'plt');this.piege=this.menu.create(-plataille*3,plataille*.5,'pie');this.etoile=this.menu.create(-plataille*1,plataille*2.5,'et');this.etoile.anchor.set(0.5);this.launch=game.add.text(plataille,plataille,lang.Tester);this.launch.anchor.setTo(0,0);this.menu.forEachAlive(this.menuForeach,this);this.plateformes.forEachAlive(function(c){c.inputEnabled=true;c.input.useHandCursor=true;c.events.onInputDown.add(alpha,this);c.events.onInputOver.add(over,this);c.events.onInputOut.add(out,this);});this.pieges.forEachAlive(function(c){c.inputEnabled=true;c.input.useHandCursor=true;c.events.onInputDown.add(alpha,this);c.events.onInputOver.add(over,this);c.events.onInputOut.add(out,this);c.inputEnabled=false;});this.game.input.onDown.add(this.clickGeneral,this);this.launch.inputEnabled=true;this.launch.input.useHandCursor=true;this.launch.events.onInputDown.add(this.letsTry,this);},letsTry: function(){edited_lvl.plateformes=[];edited_lvl.etoiles=[];edited_lvl.pieges=[];this.plateformes.forEachAlive(function(c){if(c.alpha>alph)edited_lvl.plateformes.push([c.calculDeg,c.calculLvl]);},this);this.pieges.forEachAlive(function(c){if(c.alpha>alph)edited_lvl.pieges.push([c.calculDeg,c.calculLvl]);},this);if(this.etoile_pos.alpha>0)this.etoiles.getTop().kill();this.etoiles.forEachAlive(function(c){if(c.alpha>alph)edited_lvl.etoiles.push([c.calculDeg,c.calculLvl]);},this);edited_lvl.edited=true;console.log('{'+'plateformes:['+this.objToString(edited_lvl.plateformes)+'],'+'pieges:['+this.objToString(edited_lvl.pieges)+'],'+'etoiles:['+this.objToString(edited_lvl.etoiles)+']'+'}');this.game.state.start('Play');},objToString: function(obj){var str='';var tmp=[];for(var val in obj){tmp.push('['+obj[val].join(',')+']');}str=tmp.join(',');return str;},clickGeneral: function(){if(this.etoile_pos.alpha>0){var newetoile;this.etoiles.forEachAlive(function(c){if(c.calculLvl==this.etoile_pos.calculLvl&&c.calculDeg==this.etoile_pos.calculDeg){newetoile=c;}},this);if(newetoile){newetoile.kill();}else{newetoile=this.etoiles.create(this.etoile_pos.x,this.etoile_pos.y,'et');newetoile.anchor.set(0.6);newetoile.angle=this.etoile_pos.angle;newetoile.calculLvl=this.etoile_pos.calculLvl;newetoile.calculDeg=this.etoile_pos.calculDeg;}}},choix: function(sprite){if(sprite.key=="plt"){this.changeInputEnabled(this.plateformes,true);this.changeInputEnabled(this.pieges,false);this.etoile_pos.alpha=0;}else if(sprite.key=="pie"){this.changeInputEnabled(this.plateformes,false);this.changeInputEnabled(this.pieges,true);this.etoile_pos.alpha=0;}else if(sprite.key=="et"){this.etoile_pos.alpha=alph;this.changeInputEnabled(this.plateformes,false);this.changeInputEnabled(this.pieges,false);}},changeInputEnabled: function(group,inputEnabled){if(inputEnabled){group.forEachAlive(function(c){c.inputEnabled=true;c.alpha=(c.alpha>alph)?c.alpha : inac;});}else{group.forEachAlive(function(c){c.inputEnabled=false;c.alpha=(c.alpha>alph)?c.alpha : 0;});}},menuForeach: function(c){c.inputEnabled=true;c.input.useHandCursor=true;c.events.onInputDown.add(this.choix,this);},makeSprite: function(){var cx,rayon,perimetre,nbr_plat,deg,tmp,elt;for(var i=0;i<hauteur;i++){cx=i*plataille;rayon=c/6+cx;perimetre=rayon*Math.PI*2;nbr_plat=Math.round(perimetre/plataille);deg=360/nbr_plat;for(var j=0;j<360;j+=deg){tmp=GameState.Play.prototype.placement(j,rayon);elt=this.plateformes.create(tmp[0],tmp[1],'plt');elt.anchor.set(0.5,1);elt.angle=tmp[2];elt.alpha=inac;elt.calculLvl=i;elt.calculDeg=j;if(edited_lvl.edited){for(var val in edited_lvl.plateformes){if(edited_lvl.plateformes[val][0]==elt.calculDeg&&edited_lvl.plateformes[val][1]==elt.calculLvl)elt.alpha=1;}}elt=this.pieges.create(tmp[0],tmp[1],'pie');elt.anchor.set(0.5,1);elt.angle=tmp[2];elt.alpha=0;elt.calculLvl=i;elt.calculDeg=j;if(edited_lvl.edited){for(var val in edited_lvl.pieges){if(edited_lvl.pieges[val][0]==elt.calculDeg&&edited_lvl.pieges[val][1]==elt.calculLvl)elt.alpha=1;}}}}if(edited_lvl.edited){for(var val in edited_lvl.etoiles){rayon=(edited_lvl.etoiles[val][1]+.5)*plataille+c/6;var tmp=GameState.Play.prototype.placement(edited_lvl.etoiles[val][0],rayon);var elt=this.etoiles.create(tmp[0],tmp[1],'et');elt.angle=tmp[2];elt.anchor.set(0.6);elt.calculLvl=edited_lvl.etoiles[val][1];elt.calculDeg=edited_lvl.etoiles[val][0];}}},update: function(){this.etoile.angle+=4;if(this.etoile_pos.alpha>0){var x_pointer=this.game.input.x*invert_redim-this.general.x;var y_pointer=this.game.input.y*invert_redim-this.general.y;var tmp=this.unPeuDeTrigo(x_pointer,y_pointer);var placement=GameState.Play.prototype.placement(tmp[1],tmp[0]);this.etoile_pos.x=placement[0];this.etoile_pos.y=placement[1];this.etoile_pos.angle=placement[2];this.etoile_pos.calculLvl=(tmp[0]-c/6)/plataille-0.5;this.etoile_pos.calculDeg=tmp[1];}if(this.esc_key.isDown){this.redimensionne(1);edited_lvl.edited=false;this.game.state.start('Menu');}},unPeuDeTrigo: function(x,y){var rayon=Math.sqrt(x*x+y*y);var radian=Math.atan(y/x);var degrees=radian*pi180_invers+90;if(x<0)degrees+=180;if(rayon<c/6)rayon=c/6+plataille/2;else if(rayon>(c/6+hauteur*plataille))rayon=c/6+hauteur*plataille+plataille/2;else rayon=Math.round((rayon-c/6-plataille/2)/plataille)*plataille+c/6+plataille/2;degrees=Math.round(degrees);return[rayon,degrees];},redimensionne: function(s){var s_invers=1/s;this.game.camera.scale.y=s;this.game.camera.scale.x=s;this.general.x+=((c*s_invers)*(1-s))/2;this.general.y+=((c*s_invers)*(1-s))/2;invert_redim=s_invers;},render: function(){}};function alpha(sprite){sprite.alpha=(sprite.alpha>alph)?alph : 1;}function over(sprite){sprite.alpha=(sprite.alpha<alph)?alph : 1;}function out(sprite){sprite.alpha=(sprite.alpha>alph)?1 : inac;}
var level=0;var nb_etoiles=0;var cplan=c/1.8;var rotat=2;var nuit_rotat=1.3;var nuit_depart=-10;var s=1;var s_invers=1/s;var plataille=20;GameState.Play=function(game){};GameState.Play.prototype={create: function(){this.esc_key=this.game.input.keyboard.addKey(Phaser.Keyboard.ESC);this.game.physics.startSystem(Phaser.Physics.ARCADE);if(!this.space_key){this.space_key=this.game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);this.gauche=this.game.input.keyboard.addKey(Phaser.Keyboard.LEFT);this.droite=this.game.input.keyboard.addKey(Phaser.Keyboard.RIGHT);}if(this.general){for(var val in this.tweenTab){this.tweenTab[val].stop();}this.general.destroy();}this.tweenTab=[];this.general=this.game.add.group();this.general.x=c/2;this.general.y=cplan;this.planete=this.game.add.group(this.general);this.plnte=this.planete.create(0,0,'planete');this.plnte.anchor.set(0.5);this.plateformes=this.game.add.group(this.planete);var maxPlat=this.makePlateformes();this.etoiles=this.game.add.group(this.planete);this.makeEtoiles();this.pieges=this.game.add.group(this.planete);this.makePiegesMWAHAHAHAHA();this.nuit=this.general.create(0,0,'nuit');this.nuit.anchor.set(0.5,0);this.nuit.angle=nuit_depart;this.nuit.blendMode=PIXI.blendModes.DIFFERENCE;this.dude=this.general.create(0,-c/3,'dude');this.dude.anchor.set(0.5);this.dudeTest=this.game.add.group(this.general);var dudeT1=this.dudeTest.create(0,0,'predic');var dudeT2=this.dudeTest.create(0,0,'predic');dudeT1.anchor.set(0.5,0);dudeT1.alpha=0;dudeT2.anchor.set(0.5,0);dudeT2.alpha=0;this.game.physics.enable([this.dude,this.planete,this.dudeTest],Phaser.Physics.ARCADE);this.dude.body.gravity.y=1000;this.plnte.body.immovable=true;this.plateformes.forEachAlive(function(c){c.body.immovable=true;},this);this.etoiles.forEachAlive(function(c){c.body.angularVelocity=Math.round(Math.random()*400)+100;},this);dudeT1.pivot.y=cplan-this.dude.body.y;dudeT2.pivot.y=cplan-this.dude.body.y;dudeT1.angle=rotat;dudeT2.angle=-rotat;var maxPlat=(maxPlat+plataille+this.dude.body.height)*2;if(maxPlat>=c)this.redimensionne(c/maxPlat);else this.redimensionne(1);if(edited_lvl.edited){this.goBack=game.add.text(plataille,plataille,lang.Retour);this.goBack.anchor.setTo(0,0);this.goBack.inputEnabled=true;this.goBack.input.useHandCursor=true;this.goBack.events.onInputDown.add(function(){this.game.state.start('Edit');},this);}},update: function(){/**/etoile.alive=false;/**/var t=this.game.add.tween(etoile.scale).to({x:0,y:0},300).start();/**/t.onComplete.add(function(){this.kill();},etoile);this.tweenTab.push(t);nb_etoiles-=1;if(nb_etoiles<=0){level+=1;if(edited_lvl.edited)this.game.state.start('Edit');else{if(level>=levels.length){this.redimensionne(1);this.game.state.start('Victoire');}else this.game.state.start('Play');}}},redimensionne: function(news){s=news;s_invers=1/s;this.game.camera.scale.y=s;this.game.camera.scale.x=s;this.general.x+=((c*s_invers)*(1-s))/2;this.general.y+=((c*s_invers)*(1-s))/2;this.dude.body.setSize(this.dude.body.width*s,this.dude.body.height*s,0,0);this.plnte.body.setSize(this.plnte.body.width*s,this.plnte.body.height*s,0,0);this.plateformes.forEachAlive(function(c){c.body.setSize(c.body.width*s,c.body.height*s,0,0);},this);this.dudeTest.forEachAlive(function(c){c.body.setSize(c.body.width*s,c.body.height*s,0,0);},this);},makePlateformes: function(){ if(edited_lvl.edited)var plateformes=edited_lvl.plateformes;else var plateformes=levels[level].plateformes;var maxPlat=0;for(var val in plateformes){var cx=plateformes[val][1]*plataille;var rayon=c/6+cx;var tmp=this.placement(plateformes[val][0],rayon);var plt=this.plateformes.create(tmp[0],tmp[1],'plt');plt.anchor.set(0.5,1);plt.angle=tmp[2];if(plateformes[val][1]>maxPlat)maxPlat=plateformes[val][1];}return(maxPlat*plataille+c/6);},makeEtoiles: function(){if(edited_lvl.edited)var etoiles=edited_lvl.etoiles;else var etoiles=levels[level].etoiles;for(var val in etoiles){var rayon=c/6+(etoiles[val][1]*plataille)+plataille/2;var tmp=this.placement(etoiles[val][0],rayon);var et=this.etoiles.create(tmp[0],tmp[1],'et');et.anchor.set(0.6);et.angle=tmp[2];}nb_etoiles=this.etoiles.countLiving();},makePiegesMWAHAHAHAHA: function(){if(edited_lvl.edited)var pieges=edited_lvl.pieges;else var pieges=levels[level].pieges;for(var val in pieges){var rayon=c/6+(pieges[val][1]*plataille);var tmp=this.placement(pieges[val][0],rayon);var plt=this.pieges.create(tmp[0],tmp[1],'pie');plt.anchor.set(0.5,1);plt.angle=tmp[2];}},placement: function(degrees,rayon){ var radian=((degrees-90)*pi180);var pos_x=rayon*Math.cos(radian);var pos_y=rayon*Math.sin(radian);return[pos_x,pos_y,degrees];}};
GameState.Victoire=function(game){};GameState.Victoire.prototype={create: function(){var label=game.add.text(c/2,c/2,lang.Victoire,{font: '25px Arial',fill: '#'+bleu,align: 'center'});label.anchor.setTo(0.5,0.5);label.alpha=0;this.game.add.tween(label).to({alpha: 1},500).start();this.esc_key=this.game.input.keyboard.addKey(Phaser.Keyboard.ESC);level=0;},update: function(){if(this.esc_key.isDown)this.game.state.start('Menu');}};
var game=new Phaser.Game(c,c,Phaser.CANVAS,'AinsiVientLeJeu');game.state.add('Boot',GameState.Boot);game.state.add('Load',GameState.Load);game.state.add('Menu',GameState.Menu);game.state.add('Explain',GameState.Explain);game.state.add('Edit',GameState.Edit);game.state.add('Play',GameState.Play);game.state.add('Victoire',GameState.Victoire);game.state.add('Langue',GameState.Langue);game.state.start('Boot');
